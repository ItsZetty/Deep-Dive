# 3-Way Handshake

TCP 3-Way Handshakeeλ” TCP/IP λ„¤νΈμ›ν¬μ—μ„ μ•μ •μ μ΄κ³  μ—°κ²° μ§€ν–¥μ μΈ ν†µμ‹ μ„ μ„¤μ •ν•κΈ° μ„ν•΄ μ‚¬μ©λλ” μ μ°¨μ…λ‹λ‹¤. 

μ΄ μ μ°¨λ” ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ— μ‹ λΆ°ν•  μ μλ” μ—°κ²°μ„ μ„¤μ •ν•κΈ° μ„ν•΄ μ„Έ κ°μ λ©”μ‹μ§€(μ„Έκ·Έλ¨ΌνΈ)λ¥Ό κµν™ν•λ” κ³Όμ •μ„ ν¬ν•¨ν•©λ‹λ‹¤.

<img src="../images/3-Way.png" alt="3-Way Handshake">

### **1λ‹¨κ³„: SYN (SYN_SENT)**
- **ν΄λΌμ΄μ–ΈνΈ**κ°€ μ„λ²„μ— μ—°κ²°μ„ μ”μ²­ν•λ” SYN μ„Έκ·Έλ¨ΌνΈλ¥Ό μ „μ†΅
- ν΄λΌμ΄μ–ΈνΈλ” `SYN_SENT` μƒνƒκ°€ λ¨
- μ΄κΈ° μμ„ λ²νΈ(Sequence Number)μ™€ μλ„μ° ν¬κΈ°(Window Size) μ •λ³΄κ°€ ν¬ν•¨λ¨

### **2λ‹¨κ³„: SYN + ACK (SYN_RECEIVED)**
- **μ„λ²„**κ°€ ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μ„ μλ½ν•κ³  SYNκ³Ό ACK ν”λκ·Έκ°€ μ„¤μ •λ μ„Έκ·Έλ¨ΌνΈλ¥Ό μ „μ†΅
- μ„λ²„λ” `SYN_RECEIVED` μƒνƒκ°€ λ¨
- μ„λ²„μ μ΄κΈ° μμ„ λ²νΈμ™€ ν΄λΌμ΄μ–ΈνΈμ μ΄κΈ° μμ„ λ²νΈμ— λ€ν• μ‘λ‹µ(ACK=ν΄λΌμ΄μ–ΈνΈμ μ΄κΈ° μμ„ λ²νΈ + 1)μ„ ν¬ν•¨

### **3λ‹¨κ³„: ACK (ESTABLISHED)**
- **ν΄λΌμ΄μ–ΈνΈ**κ°€ μ„λ²„μ μ‘λ‹µμ„ ν™•μΈν•κ³  ACK ν”λκ·Έκ°€ μ„¤μ •λ μ„Έκ·Έλ¨ΌνΈλ¥Ό μ „μ†΅
- ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ¨λ‘ `ESTABLISHED` μƒνƒκ°€ λ¨
- μ„λ²„μ μμ„ λ²νΈμ— λ€ν• μ‘λ‹µ(ACK=μ„λ²„μ μ΄κΈ° μμ„ λ²νΈ + 1)μ„ ν¬ν•¨
- μ΄ μ μ°¨κ°€ μ™„λ£λλ©΄ ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ κ°„μ— μ‹ λΆ°ν•  μ μλ” μ—°κ²°μ΄ μ„¤μ •λκ³ , λ°μ΄ν„° μ „μ†΅μ΄ μ‹μ‘λ  μ μμµλ‹λ‹¤.

### **3-Way Handshake μƒνƒ λ³€ν™”**

| λ‹¨κ³„ | ν΄λΌμ΄μ–ΈνΈ μƒνƒ | μ„λ²„ μƒνƒ | μ„¤λ… |
|------|----------------|-----------|------|
| **1λ‹¨κ³„** | `SYN_SENT` | `LISTEN` | ν΄λΌμ΄μ–ΈνΈκ°€ SYN μ „μ†΅, μ„λ²„λ” μ—°κ²° μ”μ²­ λ€κΈ° |
| **2λ‹¨κ³„** | `SYN_SENT` | `SYN_RECEIVED` | μ„λ²„κ°€ SYN+ACK μ „μ†΅ |
| **3λ‹¨κ³„** | `ESTABLISHED` | `ESTABLISHED` | ν΄λΌμ΄μ–ΈνΈκ°€ ACK μ „μ†΅, μ—°κ²° μ™„λ£ |

## π¤·π»β€β™‚οΈ κ·ΈλΌ TCP μ—°κ²° μΆ…λ£ν•  λ•λ” μ–΄λ–»κ² ν•λ‚μ”?

TCP μ—°κ²° μΆ…λ£λ” 4-Way Handshakeλ¥Ό ν†µν•΄ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤. μ—°κ²° μ„¤μ •κ³Ό λ‹¬λ¦¬ μΆ…λ£λ” μ–‘λ°©ν–¥μΌλ΅ κ°κ° λ…λ¦½μ μΌλ΅ μ΄λ£¨μ–΄μ Έμ•Ό ν•κΈ° λ•λ¬Έμ— 4λ‹¨κ³„κ°€ ν•„μ”ν•©λ‹λ‹¤.

<img src="../images/4-Way.png" alt="4-Way Handshake">

### **1λ‹¨κ³„: FIN (FIN_WAIT_1)**
- **ν΄λΌμ΄μ–ΈνΈ**κ°€ μ—°κ²° μΆ…λ£λ¥Ό μ”μ²­ν•λ” FIN μ„Έκ·Έλ¨ΌνΈλ¥Ό μ„λ²„μ— μ „μ†΅
- ν΄λΌμ΄μ–ΈνΈλ” `FIN_WAIT_1` μƒνƒκ°€ λ¨
- λ” μ΄μƒ λ°μ΄ν„°λ¥Ό λ³΄λ‚΄μ§€ μ•κ² λ‹¤λ” μλ―Έ

### **2λ‹¨κ³„: ACK (CLOSE_WAIT)**
- **μ„λ²„**κ°€ ν΄λΌμ΄μ–ΈνΈμ FIN μ”μ²­μ„ λ°›κ³  ACKλ΅ μ‘λ‹µ
- μ„λ²„λ” `CLOSE_WAIT` μƒνƒκ°€ λ¨
- ν΄λΌμ΄μ–ΈνΈλ” `FIN_WAIT_2` μƒνƒκ°€ λ¨
- μ„λ²„λ” μ•„μ§ λ³΄λ‚Ό λ°μ΄ν„°κ°€ μμ„ μ μμ

### **3λ‹¨κ³„: FIN (LAST_ACK)**
- **μ„λ²„**κ°€ μμ‹ μ λ°μ΄ν„° μ „μ†΅μ„ μ™„λ£ν•κ³  FIN μ„Έκ·Έλ¨ΌνΈλ¥Ό ν΄λΌμ΄μ–ΈνΈμ— μ „μ†΅
- μ„λ²„λ” `LAST_ACK` μƒνƒκ°€ λ¨
- μ„λ²„λ„ λ” μ΄μƒ λ°μ΄ν„°λ¥Ό λ³΄λ‚΄μ§€ μ•κ² λ‹¤λ” μλ―Έ

### **4λ‹¨κ³„: ACK (TIME_WAIT)**
- **ν΄λΌμ΄μ–ΈνΈ**κ°€ μ„λ²„μ FIN μ”μ²­μ„ λ°›κ³  ACKλ΅ μ‘λ‹µ
- ν΄λΌμ΄μ–ΈνΈλ” `TIME_WAIT` μƒνƒκ°€ λ¨
- μ΄ν›„ μ–‘μ½ λ¨λ‘ `CLOSED` μƒνƒκ°€ λμ–΄ μ—°κ²°μ΄ μ™„μ „ν μΆ…λ£λ¨

### **4-Way Handshake μƒνƒ λ³€ν™”**

| λ‹¨κ³„ | ν΄λΌμ΄μ–ΈνΈ μƒνƒ | μ„λ²„ μƒνƒ | μ„¤λ… |
|------|----------------|-----------|------|
| **1λ‹¨κ³„** | `FIN_WAIT_1` | `ESTABLISHED` | ν΄λΌμ΄μ–ΈνΈκ°€ FIN μ „μ†΅ |
| **2λ‹¨κ³„** | `FIN_WAIT_2` | `CLOSE_WAIT` | μ„λ²„κ°€ ACK μ „μ†΅ |
| **3λ‹¨κ³„** | `FIN_WAIT_2` | `LAST_ACK` | μ„λ²„κ°€ FIN μ „μ†΅ |
| **4λ‹¨κ³„** | `TIME_WAIT` | `CLOSED` | ν΄λΌμ΄μ–ΈνΈκ°€ ACK μ „μ†΅ |
| **μ™„λ£** | `CLOSED` | `CLOSED` | μ—°κ²° μ™„μ „ μΆ…λ£ |

## π¤·π»β€β™‚οΈ κ° μƒνƒλ³„ μλ―Έκ°€ κ¶κΈν•©λ‹λ‹¤.

### **μƒνƒλ³„ μƒμ„Έ μ„¤λ…**

#### **3-Way Handshake μƒνƒ**
- **`CLOSED`**: μ΄κΈ° μƒνƒ, μ—°κ²° μ—†μ
- **`LISTEN`**: μ„λ²„κ°€ μ—°κ²° μ”μ²­ λ€κΈ° μ¤‘
- **`SYN_SENT`**: ν΄λΌμ΄μ–ΈνΈκ°€ SYN μ „μ†΅ ν›„ λ€κΈ°
- **`SYN_RECEIVED`**: μ„λ²„κ°€ SYN μμ‹  ν›„ SYN+ACK μ „μ†΅
- **`ESTABLISHED`**: μ—°κ²° μ™„λ£, λ°μ΄ν„° μ „μ†΅ κ°€λ¥

#### **4-Way Handshake μƒνƒ**
- **`FIN_WAIT_1`**: ν΄λΌμ΄μ–ΈνΈκ°€ FIN μ „μ†΅ ν›„ μ„λ²„ ACK λ€κΈ°
- **`FIN_WAIT_2`**: μ„λ²„ ACK μμ‹  ν›„ μ„λ²„ FIN λ€κΈ°
- **`CLOSE_WAIT`**: μ„λ²„κ°€ ν΄λΌμ΄μ–ΈνΈ FIN μμ‹ , μμ‹ μ FIN μ „μ†΅ λ€κΈ°
- **`LAST_ACK`**: μ„λ²„κ°€ FIN μ „μ†΅ ν›„ ν΄λΌμ΄μ–ΈνΈ ACK λ€κΈ°
- **`TIME_WAIT`**: ν΄λΌμ΄μ–ΈνΈκ°€ ACK μ „μ†΅ ν›„ 2MSL λ€κΈ°
- **`CLOSED`**: μ—°κ²° μ™„μ „ μΆ…λ£