# Logging and Metrics

**로깅(Logging)**과 **메트릭(Metrics)**은 애플리케이션의 상태를 모니터링하고 문제를 진단하는 핵심 요소입니다.

로깅은 애플리케이션의 동작을 기록하고, 메트릭은 성능과 상태를 수치화하여 모니터링합니다.

## 🤷🏻‍♂️ 로깅과 메트릭을 어떻게 수집하나요?

### 1. 메트릭 수집 (Spring Boot Actuator + Prometheus + Grafana)

**Spring Boot Actuator**
- 애플리케이션의 상태와 메트릭을 자동으로 수집
- `/actuator` 엔드포인트를 통해 메트릭 노출

**수집한 지표**
- **시스템 리소스**: CPU, 메모리, JVM 힙 사용량
- **애플리케이션 상태**: 톰캣 스레드 풀과 데이터베이스 커넥션 풀 상태
- **에러 모니터링**: error 레벨 로그 증가량

**Prometheus**
- 메트릭 데이터를 수집하고 저장
- 시계열 데이터베이스로 장기 보관

**Grafana**
- 수집된 메트릭을 시각화
- 대시보드를 통한 실시간 모니터링

### 2. 로깅 수집 (Logback + Loki + MDC)

**Logback**
- Spring Boot의 기본 로깅 프레임워크
- 다양한 로그 레벨과 출력 형식 지원

**Loki**
- 로그 수집 및 저장 시스템
- 7일간 로그 보관 설정

**MDC (Mapped Diagnostic Context)**
- 로그 추적을 위한 컨텍스트 정보 추가
- 요청별 고유 식별자로 로그 연결

## 🤷🏻‍♂️ 왜 로깅과 메트릭이 중요한가요?

### 1. 문제 진단
- **에러 로그**: 문제 발생 원인 파악
- **메트릭**: 성능 병목 지점 식별

### 2. 성능 모니터링
- **실시간 모니터링**: 시스템 상태 파악
- **트렌드 분석**: 성능 변화 추이 확인

### 3. 사용자 경험 개선
- **응답 시간**: 사용자 만족도에 직접적 영향
- **가용성**: 서비스 중단 시간 최소화

## 📚 추가 내용

### 모니터링 아키텍처

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Spring    │    │ Prometheus  │    │   Grafana   │
│   Boot      │───▶│             │───▶│             │
│  Actuator   │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │
       ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Logback   │    │    Loki     │    │     MDC     │
│             │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘
```

### 주요 메트릭 종류

| 카테고리 | 메트릭 | 설명 |
|----------|--------|------|
| 시스템 | CPU, Memory | 서버 리소스 사용량 |
| JVM | Heap, GC | 자바 가상머신 상태 |
| 애플리케이션 | Thread Pool, DB Pool | 애플리케이션 성능 |
| 비즈니스 | DAU, Retention | 사용자 활동 지표 |

### 로그 레벨

| 레벨 | 용도 | 예시 |
|------|------|------|
| ERROR | 심각한 오류 | 시스템 장애, 데이터 손실 |
| WARN | 경고 | 성능 저하, 리소스 부족 |
| INFO | 일반 정보 | 요청 처리, 비즈니스 로직 |
| DEBUG | 디버깅 | 상세한 실행 흐름 |

> **💡 핵심 포인트**: 로깅과 메트릭은 애플리케이션의 건강 상태를 파악하고 문제를 사전에 방지하는 필수적인 도구입니다. 